# CBL 알고리즘 정의

## CBL(Customer Baseline Load, 고객 기준 부하)

### CBL이란?

- 전력 수요 및 에너지 관리 분야에서 사용되는 개념으로, 특정 시간대에 예상되는 **기준 전력 소비량**
- 고객이 에너지를 절감했는지 또는 추가로 소비했는지를 평가하기 위해 사용

---

## DR 개발을 위한 CBL 산출 식

### 고려 사항

- Mid 값은 언제든지 변경될 수 있다는 가정 필요
- Mid(3/5), Mid(8/10) 등 다양한 CBL 산출 방식 지원
- **피에스텍** 사용량의 경우 **1시간 단위**로 데이터가 수집되므로, **발령 시작 시간 ~ 발령 종료 시간의 차**를 계산해야 함

---

## Mid(3/5) 방식

**서울시 DR**은 기본적으로 **Mid(3/5)** 로 CBL 산출

### 계산 방식

- **최근 5일**의 데이터를 기준으로 **가장 낮은 2일을 제외**
- 중간 값에 가까운 **3일의 데이터를 사용해 평균 값을 계산**
- 우리 시스템은 **최대 값 1개, 최소 값 1개를 제외**하는 방식 적용

---

## 핵심 계산 공식

### 1. CBL(기준 부하) 계산

```
CBL = (Day1 + Day2 + Day3) / 3

예시: CBL = (120 + 110 + 113) / 3 = 114.33
```

### 2. 절감량 & 절감률 계산

```
절감량 = CBL - 발령날 사용량
절감률 = (절감량 / CBL) × 100

예시:
절감량 = 114.33(CBL) - 120(발령날) = -5.67
절감률 = -5.67 / 114.33 × 100 = -4.96%
```

| 결과 | 의미 |
|------|------|
| **양수** | 절감 성공 |
| **음수** | 절감 실패 |

### 3. 증감량 & 증감률 계산

```
증감량 = 발령날 사용량 - CBL
증감률 = (증감량 / CBL) × 100

예시:
증감량 = 120(발령날) - 114.33(CBL) = 5.67
증감률 = 5.67 / 114.33 × 100 = 4.96%
```

### 4. 표준편차 계산

1. **평균** = CBL
2. **각 데이터의 편차 계산**: 각 일자 데이터 - 평균
3. **분산**: 편차 제곱의 평균
4. **표준편차**: √분산

---

## 계산 플로우

```
┌─────────────────────────────────────────────────────────────┐
│                    CBL 계산 프로세스                          │
├─────────────────────────────────────────────────────────────┤
│  1. 최근 N일 데이터 조회 (발령일 제외)                         │
│                    ↓                                         │
│  2. 사용량 기준 정렬                                          │
│                    ↓                                         │
│  3. 최대/최소 이상치 제거                                     │
│                    ↓                                         │
│  4. 중간 값들의 평균 계산 → CBL                               │
│                    ↓                                         │
│  5. 절감량/절감률, 증감량/증감률, 표준편차 산출                 │
└─────────────────────────────────────────────────────────────┘
```

---

## 지표 요약

| 지표 | 공식 | 설명 |
|------|------|------|
| **CBL** | 중간 N일 평균 | 기준 전력 소비량 |
| **절감량** | CBL - 발령날 사용량 | 양수면 절감 성공 |
| **절감률** | (절감량 / CBL) × 100 | 절감 비율 (%) |
| **증감량** | 발령날 사용량 - CBL | 사용량 변동폭 |
| **증감률** | (증감량 / CBL) × 100 | 변동 비율 (%) |
| **표준편차** | √(편차² 평균) | 데이터 분산도 |

---

[← Back to DR Service](./README.md) | [← Back to Portfolio](../../README.md)
