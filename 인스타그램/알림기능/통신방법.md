# 알림 기능의 통신 방법 고민

## 개요

댓글이나 좋아요 알림은 유저의 요청 없이도 실시간으로 서버의 변경 상항을 웹 브라우저에 갱신해줘야 하는 서비스이다. 하지만 전통적인 Client-Server 모델의 HTTP 통신에서는 이런한 기능을 구현하기 어렵다. 클라이언트의 요청이 있어야만 서버가 응답할 수 있기 때문이다. 

우선 어떠한 방식으로 진행할지 고민하기 위해 통신 방법에 대해 알아보았다.

## 실시간 통신 방법

### Polling

![스크린샷 2024-01-17 오전 10.57.01.png](https://github.com/Heo-y-y/development-blog/assets/112863029/34d6002a-135d-40cb-a085-3f340fb77f9b)

일정 주기를 가지고 서버의 API를 호출하는 방법이다. 예를 들어, 클라이언트에서 5초마다 한 번씩 알림 목록을 호출한다면, 업데이트 내역이 5초마다 갱신되며 변경 사항을 적용할 수 있다. 이 방식은 기본적인 HTTP 통신을 기반으로 하기 때문에 호환성이 좋다는 장점이 있다.

하지만 해당 방식은 업데이트 주기가 길어질 경우 실시간으로 데이터가 갱신 되지 않고, 또 짧다면 갱신 사항이 없음에도 서버에 요청이 들어와 불필요한 서버 부하가 발생한다.

### Long-Polling

![스크린샷 2024-01-17 오전 11.01.45.png](https://github.com/Heo-y-y/development-blog/assets/112863029/6037412d-e15a-441c-a737-7ad8abbc5b2f)

Polling과 비슷하나 업데이트 발생시에만 응답을 보내는 방식이다. 서버로 요청이 들어올 경우, 일정 시간동안 대기하였다가 요청한 데이터가 업데이트 되면 웹 브라우저에게 응답을 보낸다.

Polling에서 불필요한 응답을 주는 경우를 줄이기 위해 사용할 수 있는 방법이다. 따라서 연결이 된 경우엔 실시간으로 데이터가 들어올 수 있다는 장점이 있다.

하지만 이 방식 또한 데이터 업데이트가 빈번하게 일어난다면 연결을 위한 요청도 똑같이 발생하므로, Polling과 유사하게 서버 부하가 일어날 수 있다.

### SEE(Sever-Sent Event)

![스크린샷 2024-01-17 오전 11.07.26.png](https://github.com/Heo-y-y/development-blog/assets/112863029/82f33b4f-3242-4f8a-a314-ade5483c8151)

웹 브라우저에서 서버쪽으로 특정 이벤트를 구독하면, 서버에서는 해당 이벤트 발생시 웹 브라우저쪽으로 이벤트를 보내주는 방식이다. 따라서 한 번만 연결 요청을 보내면, 연결이 종료될 때까지 재 연결 과정 없이 서버에서 웹 브라우저로 데이터를 계속해서 보낼 수 있다.

다만, 서버에서 웹 브라우저로만 데이터 전송이 가능하고, 그 반대는 불가능하다는 단점이 있다. 또한 최대 동시 접속 횟수가 제한되어 있다.

### Web Socket

![스크린샷 2024-01-17 오전 11.11.03.png](https://github.com/Heo-y-y/development-blog/assets/112863029/4597456c-f748-4ae2-8229-ac2bae0d9f3f)

서버와 웹 브라우저 사이 양방향 통신이 가능한 방법이다. 변경 사항에 빠르게 반응해야하는 채팅이나, 리소스 상태에 대한 지속적 업데이트가 필요한 문서 동시 편집과 같은 서비스에 많이 사용되는 방식이다.

이 방식은 양방향 통신이 지속적으로 이루어질 수는 있으나, 연결을 유지하는 것 자체가 비용이 들기 때문에 트래픽 양이 많아진다면 서버에 큰 부담이 된다는 단점이 있다.

## 결론

Polling 방식은 실시간성을 높이려면 그 주기를 짧게 가져가야 하는데, 트래픽이 많아질 경우 서버에 걸리는 부하가 커지기 때문에 알림 서비스에는 부적합하다고 생각한다.

Long-Polling 역시 마찬가지로, 트래픽이 많아지면 요청도 그만큼 많아지므로 부적합하다.

그렇다면 **HTTP 연결 방식에 대한 부담이 적은** SSE와 WebSocket 방식이 남는데, 알림 서비스의 경우 클라이언트에서 서버로 데이터를 전송하지 않아도 되어서 **단방향 통신**만으로도 구현할 수 있으므로 구현할 수 있는 **SSE 방식을 선택**하게 됐다.
