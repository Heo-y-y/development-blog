# [Docker] - 도커 컨테이너와 이미지

도커의 사용 이유와 작동 흐름에 대해 알아보자.

## 도커란?

도커는 컨테이너를 생성하고 관리하기 위한 도구이다.

소프트웨어 개발에서 컨테이너란 소프트웨어 유닛을 의미한다. 쉽게 말해 코드들의 패키지와 해당 코드를 실행하는데 필요한 의존성과 도구를 의미한다.

즉, 동일한 컨테이너를 사용한다면 동일한 환경에서 정확히 동일한 애플리케이션을 실행할 수 있다.

도커는 이러한 컨테이너를 구축하고, 관리하기 위한 도구일 뿐이다.

## 왜 도커를 사용할까?

가상화 기술이 나오기 전에는 하나의 서버는 하나의 용도로만 사용되었었다.

하나의 서버에는 하나의 운영체제만 있었고, 하나의 프로그램만을 운영하였다. 이는 안정적이나 비효율적이다.

그러던 중 하이퍼 바이저 기반의 가상화 방식이 출현하였다. 하이퍼 바이저를 통해 논리적으로 공간을 분할하여 독립적인 가상 환경(VM)의 서버 이용이 가능해졌다.

### 하이퍼 바이저란?

**가상 머신**(Virtual Machine)을 생성하고 실행하는 프로세스이다.

하이퍼바이저는 메모리 및 처리와 같은 단일 호스트 컴퓨터의 리소스를 가상으로 공유하여 호스트 컴퓨터가 여러 게스트 가상 머신을 지원할 수 있도록 한다.

가상 머신(VM)과 **도커 컨테이너**는 기본 하드웨어와 격리된 환경에서 애플리케이션을 배치하는 방법이다. 그러나 격리시키는 환경의 수준에서 차이가 발생한다.

VM에서는 애플리케이션을 실해하기 위해 VM에 지원을 할당하고, 게스트 OS를 부팅해야 한다. 이는 매우 복잡하며 무겁다.

그러나 컨테이너 방식에서는 호스트 OS 위에서 게스트 OS 없이 애플리케이션의 실행 패키지(= 이미지)를 배포하면 실행이 가능하다. 즉, 기존의 VM보다 훨씬 가벼운 방법이다.

**도커와 하이퍼바이저**

![Untitled](https://github.com/Heo-y-y/development-blog/assets/112863029/e653b581-1b42-49d2-af67-456915d63ab5)

도커의 컨테이너 각각은 서로 격리되어있지만, 같은 호스트 OS의 다른 컨테이너들과 **동일한 커널**을 공유한다.

![스크린샷 2024-01-31 오후 2 59 12](https://github.com/Heo-y-y/development-blog/assets/112863029/74d32f0e-d311-4180-a729-52878a705e92)

## 컨테이너란?

애플리케이션이 한 컴퓨팅 환경에서 다른 컴퓨팅 환경으로 빠르고 안정적으로 실행될 수 있도록 **코드와 모든 종속성**을 **패키징**하는 소프트웨어의 표준 단위이다.

### 컨테이너의 격리

컨테이너의 격리가 가능한 이유는 cgoup과 namespace 덕분이다.

## 도커 이미지란?

코드, 런타임 시스템 도구, 명령어, 시스템 라이브러리 및 설정과 같이 **애플리케이션을 실행하는 데 필요한  모든 것**을 포함하는 가벼운 독립 실행형 실행 소프트웨어 패키지이다.

도커 컨테이너의 경우 도커 컨테이너 이미지가 Docker Engine에서 실행될 때 도커 컨테이너가 된다.

도커 이미지는 다음을 포함한다.

- 시작시에 실행 될 명령어(프로그램을 실행할 명령어)
- 파일 스냅샷(실행될 프로그램 파일)

도커 이미지를 통해 컨테이너가 실행될 때, 도커 이미지가 가진 파일 스냅샷이 도커 컨테이너 내부의 하드디스크에 저장된다.

### 도커 이미지가 컨테이너가 되는 과정

1. Docker 클라이언트에 명령어('docker run **이미지**')를 입력한다.
2. 이미지는 프로그램 실행시 필요한 명령어와 실행될 프로그램 파일에 대한 스냅샷을 가지고 있다.
3. 파일 스냅샷을 컨테이너 내부의 하드 디스크에 제공한다.
4. 프로그램 실행시 필요한 명령어를 컨테이너에 제공한다.
5. 컨테이너는 실행될 때, 전달받은 명령어를 통해 파일을 실행시킨다.

## 도커 작동 방식

항상 도커를 사용할 때에는 먼저 도커 CLI에 명령어를 입력해야 한다. 그러면 도커 서버가 해당 명령어에 따라 작업을 실행한다.

1. 도커 실행
    
    ![스크린샷 2024-01-31 오후 3.16.40.png](https://github.com/Heo-y-y/development-blog/assets/112863029/1e38b7bd-ad01-484c-8375-992897bd8df2)
    
    위 사진처럼 도커가 실행중이어야 한다.
    
2. 터미널 사용
    
    ```bash
    docker run hello-world
    ```
    
    ![스크린샷 2024-01-31 오후 3.18.56.png](https://github.com/Heo-y-y/development-blog/assets/112863029/c777d540-215b-4693-b7e0-30d8cbf513f0)
    
    위 과정에서의 흐름은 아래와 같다.
    
    1. 컴퓨터의 도커 클라이언트에게 docker run hello-world라는 명령어가 전달된다.
    2. 도커 클라이언트는 컴퓨터에 있는 도커 서버에 해당 명령어를 전달한다.
    3. 도커 서버는 컴퓨터 내부 도커 이미지 Cache 저장소에서 hello-world라는 이미지가 있는지 찾는다.
    4. 없는 경우 도커 허브(docker-hub)에 해당 이미지를 찾아서 가져온다. 또한 Cache 저장소에 저장한다.
    5. 이후 실행 시에는 해당 이미지가 Cache 저장소에 있으므로 다운받지 않고 바로 실행된다.
    
    ---
    
    **참고 자료**
    
    - <https://www.docker.com/resources/what-container/>
    - <https://ttl-blog.tistory.com/747>
